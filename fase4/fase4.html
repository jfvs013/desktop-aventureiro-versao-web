<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fase 4 ‚Äî Manchetes Suspeitas</title>

    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #00d4ff;
            --success: #2ecc71;
            --danger: #ff5c5c;
            --warning: #ffc107;
            --text: #f8fafc;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            overflow: hidden;
        }

        /* Topbar */
        .game-topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .left-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #mascote-small {
            width: 50px;
            height: 50px;
            transition: all 0.3s ease;
        }

        .player-area div {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .right-info #timer {
            font-size: 1.5rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 8px;
        }

        /* Game Area */
        .game-area {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 100px);
        }

        /* Colunas de Drop */
        .drop-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .drop-zone {
            flex: 1;
            border: 3px dashed rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .drop-zone.over {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.05);
        }

        .drop-zone.verdadeira {
            border-color: var(--success);
            color: var(--success);
        }

        .drop-zone.falsa {
            border-color: var(--danger);
            color: var(--danger);
        }

        /* News Feed */
        .news-column {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .headline-card {
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            cursor: grab;
            width: 90%;
            max-width: 400px;
            margin-top: 50px;
            position: relative;
            border-left: 8px solid #ddd;
        }

        .headline-card.dragging {
            opacity: 0.5;
        }

        .headline-card h2 {
            margin: 0 0 15px 0;
            font-size: 1.2rem;
            line-height: 1.4;
            color: #111;
        }

        .source-tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: bold;
            color: #666;
            display: block;
            margin-bottom: 5px;
        }

        /* Lupa / Verificar Fonte */
        .source-details {
            margin-top: 15px;
            padding: 10px;
            background: #f1f5f9;
            border-radius: 5px;
            font-size: 0.85rem;
            display: none;
            border: 1px solid #cbd5e1;
        }

        /* Feedback Box & Buttons */
        .help-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .feedback-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            font-style: italic;
        }

        .primary-btn,
        .secondary-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .primary-btn {
            background: var(--primary);
            color: white;
        }

        .secondary-btn {
            background: var(--warning);
            color: #000;
        }

        .primary-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-inner {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            border: 2px solid var(--primary);
        }
    </style>
</head>

<body>
    <div class="game-topbar">
        <div class="left-info">
            <img id="mascote-small" src="../assets/mascote.png" alt="Mascote"
                onerror="this.src='https://cdn-icons-png.flaticon.com/512/616/616408.png'" />
            <div class="player-area">
                <div id="playerDisplay">Jogador: ‚Äî</div>
                <div id="scoreDisplay">Pontos: 0</div>
            </div>
        </div>
        <div class="right-info">
            <div id="timer">Tempo: 60</div>
        </div>
    </div>

    <main class="game-area">
        <section class="drop-column">
            <div id="verdadeira" class="drop-zone verdadeira">
                <span style="font-size: 3rem;">üü©</span>
                <p>Not√≠cia Verdadeira<br>(Arraste aqui)</p>
            </div>
        </section>

        <section class="news-column">
            <h3>üì∞ Verifica√ß√£o de Not√≠cias</h3>
            <div id="headlineContainer" style="width: 100%; display: flex; justify-content: center;">
            </div>
            <p class="hint" style="margin-top: 20px; font-size: 0.8rem; opacity: 0.7;">
                Dica: Use a "Lupa do C√£ozinho" para ganhar b√¥nus de Verifica√ß√£o!
            </p>
        </section>

        <aside class="help-column">
            <button id="inspectBtn" class="secondary-btn">
                üîç Verificar Fonte
            </button>

            <div id="feedbackBox" class="feedback-box">
                "Ol√°! Sou o C√£ozinho Aventureiro. Analise bem as manchetes!"
            </div>

            <div id="fakeZone" class="drop-zone falsa">
                <span style="font-size: 3rem;">üü•</span>
                <p>Fake News<br>(Arraste aqui)</p>
            </div>
        </aside>
    </main>

    <div id="endModal" class="modal hidden">
        <div class="modal-inner">
            <h2 id="endTitle">Fim da Triagem!</h2>
            <p id="endText"></p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button onclick="location.reload()" class="primary-btn">üîÑ Tentar Novamente</button>
                <button id="backBtn" class="secondary-btn">üè† In√≠cio</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configura√ß√µes e Vari√°veis de Estado ---
            const headlinesData = [
                {
                    id: 1, isFake: false,
                    title: "Nova vacina contra a gripe come√ßa a ser distribu√≠da em postos de sa√∫de de todo o pa√≠s.",
                    source: "Portal Nacional de Sa√∫de",
                    date: "12/01/2026",
                    reputation: "Alta - √ìrg√£o Oficial",
                    detail: "Informa√ß√£o confirmada por secretarias estaduais e canais de sa√∫de p√∫blica.",
                    edu: "Sites oficiais com dom√≠nios .gov ou .org de sa√∫de s√£o fontes confi√°veis."
                },
                {
                    id: 2, isFake: true,
                    title: "URGENTE: Cientistas descobrem que comer chocolate cura todas as doen√ßas em 24 horas!",
                    source: "Not√≠ciasIncr√≠veis.xyz",
                    date: "Hoje",
                    reputation: "Desconhecida",
                    detail: "Nenhuma universidade ou hospital confirmou esse estudo. O site est√° cheio de an√∫ncios.",
                    edu: "Promessas de 'curas milagrosas' s√£o sinais cl√°ssicos de Fake News."
                },
                {
                    id: 3, isFake: false,
                    title: "NASA confirma nova miss√£o para estudar a superf√≠cie de Marte em 2028.",
                    source: "Ag√™ncia Espacial Internacional",
                    date: "10/01/2026",
                    reputation: "Alta",
                    detail: "O projeto faz parte do programa de explora√ß√£o planet√°ria decenal.",
                    edu: "Not√≠cias de ci√™ncia costumam citar ag√™ncias espaciais conhecidas."
                },
                {
                    id: 4, isFake: true,
                    title: "CUIDADO! O governo vai cancelar a internet de quem n√£o compartilhar esta mensagem!",
                    source: "WhatsApp Repassado",
                    date: "Imediato",
                    reputation: "Nula",
                    detail: "Texto com tom de amea√ßa, erros de portugu√™s e sem links para portais oficiais.",
                    edu: "Mensagens que pedem compartilhamento para evitar puni√ß√µes s√£o quase sempre golpes."
                },
                {
                    id: 5, isFake: true,
                    title: "VOC√ä N√ÉO VAI ACREDITAR: Fruta secreta da Amaz√¥nia emagrece 10kg por dia sem exerc√≠cio!",
                    source: "DicasSaudeTop.com",
                    date: "05/01/2026",
                    reputation: "Baixa",
                    detail: "A manchete usa sensacionalismo ('Voc√™ n√£o vai acreditar') para atrair cliques.",
                    edu: "T√≠tulos sensacionalistas (Clickbait) tentam manipular sua curiosidade."
                },
                {
                    id: 6, isFake: false,
                    title: "Inaugura√ß√£o da nova biblioteca municipal atrai centenas de estudantes e fam√≠lias.",
                    source: "Jornal da Cidade",
                    date: "Ontem",
                    reputation: "Local Confi√°vel",
                    detail: "Evento p√∫blico registrado por fotos e depoimentos de moradores locais.",
                    edu: "Fatos locais comprov√°veis por fotos reais tendem a ser verdadeiros."
                }
            ];

            let score = 0;
            let timeLeft = 60;
            let currentStreak = 0;
            let totalCorrect = 0;
            let totalAnswered = 0;
            let activeHeadline = null;
            let timerInterval;

            const player = localStorage.getItem('da_player') || 'Aventureiro';
            document.getElementById('playerDisplay').textContent = `Jogador: ${player}`;

            // --- Elementos DOM ---
            const container = document.getElementById('headlineContainer');
            const timerEl = document.getElementById('timer');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const feedbackBox = document.getElementById('feedbackBox');
            const inspectBtn = document.getElementById('inspectBtn');
            const mascote = document.getElementById('mascote-small');

            // --- Inicializa√ß√£o ---
            shuffleArray(headlinesData);
            renderNextHeadline();
            startTimer();

            // --- L√≥gica do Jogo ---
            function startTimer() {
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerEl.textContent = `Tempo: ${timeLeft}`;
                    if (timeLeft <= 10) timerEl.style.color = '#ff5c5c';
                    if (timeLeft <= 0) finishGame();
                }, 1000);
            }

            function renderNextHeadline() {
                container.innerHTML = '';
                if (headlinesData.length === 0) {
                    finishGame();
                    return;
                }

                activeHeadline = headlinesData.shift();
                const card = document.createElement('div');
                card.className = 'headline-card';
                card.draggable = true;
                card.innerHTML = `
                    <span class="source-tag">Fonte Suspeita: ???</span>
                    <h2>${activeHeadline.title}</h2>
                    <div id="details-${activeHeadline.id}" class="source-details">
                        <strong>üîç Detalhes da Fonte:</strong><br>
                        Origem: ${activeHeadline.source}<br>
                        Data: ${activeHeadline.date}<br>
                        Reputa√ß√£o: ${activeHeadline.reputation}<br>
                        <em>${activeHeadline.detail}</em>
                    </div>
                `;

                card.addEventListener('dragstart', (e) => {
                    card.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', activeHeadline.id);
                });

                card.addEventListener('dragend', () => card.classList.remove('dragging'));
                container.appendChild(card);

                // Reset da interface de inspe√ß√£o
                inspectBtn.disabled = false;
                activeHeadline.checked = false;
            }

            // Sistema de Drop
            setupDropZone('verdadeira', false);
            setupDropZone('fakeZone', true);

            function setupDropZone(id, isFakeZone) {
                const zone = document.getElementById(id);
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('over'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('over');
                    processChoice(isFakeZone);
                });
            }

            function processChoice(choseFake) {
                totalAnswered++;
                const isCorrect = (activeHeadline.isFake === choseFake);

                if (isCorrect) {
                    let gain = 100;
                    if (activeHeadline.checked) gain += 30; // B√¥nus por verificar
                    score += gain;
                    totalCorrect++;
                    currentStreak++;

                    if (currentStreak % 3 === 0) {
                        timeLeft += 3;
                        flashFeedback("üî• Combo! +3 segundos!", "success");
                    }

                    updateMascote('happy', `Boa! ${activeHeadline.edu}`);
                } else {
                    score -= 50;
                    if (score < 0) score = 0;
                    currentStreak = 0;
                    updateMascote('alert', `Cuidado! ${activeHeadline.edu}`);
                }

                updateUI();
                renderNextHeadline();
            }

            // Bot√£o Verificar Fonte
            inspectBtn.addEventListener('click', () => {
                if (!activeHeadline) return;

                const detailEl = document.getElementById(`details-${activeHeadline.id}`);
                detailEl.style.display = 'block';
                activeHeadline.checked = true;
                timeLeft -= 1; // Consome tempo
                inspectBtn.disabled = true;

                flashFeedback("üîç Verificando fonte... (-1s)", "hint");
            });

            // --- Auxiliares ---
            function updateUI() {
                scoreDisplay.textContent = `Pontos: ${score}`;
            }

            function updateMascote(state, text) {
                feedbackBox.textContent = text;
                if (state === 'happy') {
                    mascote.style.transform = 'scale(1.2) rotate(5deg)';
                    feedbackBox.style.color = '#2ecc71';
                } else {
                    mascote.style.transform = 'translateX(10px) rotate(-5deg)';
                    feedbackBox.style.color = '#ff5c5c';
                }
                setTimeout(() => mascote.style.transform = '', 600);
            }

            function flashFeedback(text, type) {
                const msg = document.createElement('div');
                msg.style.position = 'fixed';
                msg.style.top = '100px';
                msg.style.left = '50%';
                msg.style.transform = 'translateX(-50%)';
                msg.style.padding = '10px 20px';
                msg.style.borderRadius = '20px';
                msg.style.backgroundColor = type === 'success' ? '#2ecc71' : '#ffc107';
                msg.style.color = 'white';
                msg.style.fontWeight = 'bold';
                msg.style.zIndex = '2000';
                msg.textContent = text;
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 2000);
            }

            function finishGame() {
                clearInterval(timerInterval);
                const accuracy = Math.round((totalCorrect / (totalAnswered || 1)) * 100);

                // B√¥nus final de 80% de acerto
                if (accuracy >= 80) score += 200;

                const endModal = document.getElementById('endModal');
                const endText = document.getElementById('endText');

                endText.innerHTML = `
                    <p>Pontua√ß√£o Final: <strong>${score}</strong></p>
                    <p>Precis√£o: <strong>${accuracy}%</strong></p>
                    <p>Tempo Restante: ${timeLeft}s</p>
                    <br>
                    <p><em>${accuracy >= 80 ? "üê∂ Incr√≠vel! Voc√™ √© um mestre da verdade!" : "üê∂ Bom esfor√ßo! Continue treinando seu olhar cr√≠tico."}</em></p>
                `;

                endModal.classList.remove('hidden');

                const progress = JSON.parse(localStorage.getItem('da_game_progress') || '{}');
                progress.phase3Completed = true;
                progress.phase3Score = score;
                localStorage.setItem('da_game_progress', JSON.stringify(progress));
            }

            function shuffleArray(a) {
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
            }

            document.getElementById('backBtn').addEventListener('click', () => {
                window.location.href = '../index.html';
            });
        });
    </script>
</body>

</html>